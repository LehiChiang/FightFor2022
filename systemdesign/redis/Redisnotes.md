## Redis的好处、特点

- 既可以做持久化存储，也可以当作缓存。
- 作为持久层，它存储的数据是半结构化的，这意味着计算机读入内存中有更少的规则，读入速度更快。对于结构化，多范式规则的数据库而言，它更具有优势。
- 作为缓存，它支持大数据存入内存中，只要命中率高，它就能快速响应。响应速度每秒可达到大约10万次的读写操作。
- 支持5种数据类型可以满足存储各种数据结构体的需要，另一方面数据类型少，使得规则少，判断的逻辑就少，这样读写速度就更快。
- 支持分布式锁，集群，主从复制等配置。还支持一定的事务能力，在高并发场景下保证数据安全和一致性。
- 数据的相关操作使用单线程的工作方式，并且使用I/O多路复用的方式进行通信



## Redis的应用

- 热点数据加速查询（主要场景），如热点商品、热点新闻、热点资讯、推广类等高访问量信息等
- 即时信息查询，如各位排行榜、各类网站访问统计等
- 时效性信息控制，如验证码控制等
- 分布式数据共享，如分布式集群架构中的 session 分离
- 任务队列，如秒杀、抢购、购票排队等
- 单服务器升级集群
- 消息队列
- 分布式锁



## 单机的Redis存在四大问题

<img src="imgs\image-20210725144240631.png" alt="image-20210725144240631" style="zoom:67%;" />



## RDB原理

bgsave开始时会fork主进程得到子进程，子进程共享主进程的内存数据。完成fork后读取内存数据并写入 RDB 文件。

fork采用的是copy-on-write技术：

- 当主进程执行读操作时，访问共享内存；
- 当主进程执行写操作时，则会拷贝一份数据，执行写操作。

<img src="imgs/image-20210725151319695.png" alt="image-20210725151319695" style="zoom:60%;" />



## master如何判断slave节点是不是第一次来做数据同步？

有几个概念，可以作为判断依据：

- **Replication Id**：简称replid，是数据集的标记，id一致则说明是同一数据集。每一个master都有唯一的replid，slave则会继承master节点的replid
- **offset**：偏移量，随着记录在repl_baklog中的数据增多而逐渐增大。slave完成同步时也会记录当前同步的offset。如果slave的offset小于master的offset，说明slave数据落后于master，需要更新。

因此slave做数据同步，必须向master声明自己的replication id 和offset，master才可以判断到底需要同步哪些数据。



因为slave原本也是一个master，有自己的replid和offset，当第一次变成slave，与master建立连接时，发送的replid和offset是自己的replid和offset。

master判断发现slave发送来的replid与自己的不一致，说明这是一个全新的slave，就知道要做全量同步了。

master会将自己的replid和offset都发送给这个slave，slave保存这些信息。以后slave的replid就与master一致了。

因此，**master判断一个节点是否是第一次同步的依据，就是看replid是否一致**。



## 主从复制的作用

- 读写分离：master写、slave读，提高服务器的读写负载能力
- 负载均衡：基于主从结构，配合读写分离，由slave分担master负载，并根据需求的变化，改变slave的数量，通过多个从节点分担数据读取负载，大大提高Redis服务器并发量与数据吞吐量
- 故障恢复：当master出现问题时，由slave提供服务，实现快速的故障恢复
- 数据冗余：实现数据热备份，是持久化之外的一种数据冗余方式
- 高可用基石：基于主从复制，构建哨兵模式与集群，实现Redis的高可用方案
